<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width">
<meta name="theme-color" content="#222" media="(prefers-color-scheme: light)">
<meta name="theme-color" content="#222" media="(prefers-color-scheme: dark)"><meta name="generator" content="Hexo 6.3.0">

  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">



<link rel="stylesheet" href="https://unpkg.com/@fortawesome/fontawesome-free@6.2.1/css/all.min.css" integrity="sha256-Z1K5uhUaJXA7Ll0XrZ/0JhX4lAtZFpT6jkKrEDT0drU=" crossorigin="anonymous">
  <link rel="stylesheet" href="https://unpkg.com/animate.css@3.1.1/animate.min.css" integrity="sha256-PR7ttpcvz8qrF57fur/yAx1qXMFJeJFiA6pSzWi0OIE=" crossorigin="anonymous">

<script class="next-config" data-name="main" type="application/json">{"hostname":"gudiffany.github.io","root":"/","images":"/images","scheme":"Gemini","darkmode":true,"version":"8.14.2","exturl":false,"sidebar":{"position":"left","display":"always","padding":18,"offset":12},"copycode":{"enable":false,"style":null},"bookmark":{"enable":false,"color":"#222","save":"auto"},"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"stickytabs":false,"motion":{"enable":true,"async":false,"transition":{"menu_item":"fadeInDown","post_block":"fadeIn","post_header":"fadeInDown","post_body":"fadeInDown","coll_header":"fadeInLeft","sidebar":"fadeInUp"}},"prism":false,"i18n":{"placeholder":"搜索...","empty":"没有找到任何搜索结果：${query}","hits_time":"找到 ${hits} 个搜索结果（用时 ${time} 毫秒）","hits":"找到 ${hits} 个搜索结果"},"path":"/search.xml","localsearch":{"enable":true,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false}}</script><script src="/js/config.js"></script>

    <meta name="description" content="2023kalmarctf">
<meta property="og:type" content="article">
<meta property="og:title" content="2023kalmarctf复现">
<meta property="og:url" content="https://gudiffany.github.io/2023/03/06/13-29-58/index.html">
<meta property="og:site_name" content="diffany">
<meta property="og:description" content="2023kalmarctf">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://gudiffany.github.io/img/image-20230312173012382.png">
<meta property="article:published_time" content="2023-03-06T05:29:58.000Z">
<meta property="article:modified_time" content="2023-03-13T12:18:01.800Z">
<meta property="article:author" content="diffany">
<meta property="article:tag" content="2023ctf">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://gudiffany.github.io/img/image-20230312173012382.png">


<link rel="canonical" href="https://gudiffany.github.io/2023/03/06/13-29-58/">



<script class="next-config" data-name="page" type="application/json">{"sidebar":"","isHome":false,"isPost":true,"lang":"zh-CN","comments":true,"permalink":"https://gudiffany.github.io/2023/03/06/13-29-58/","path":"2023/03/06/13-29-58/","title":"2023kalmarctf复现"}</script>

<script class="next-config" data-name="calendar" type="application/json">""</script>
<title>2023kalmarctf复现 | diffany</title>
  








  <noscript>
    <link rel="stylesheet" href="/css/noscript.css">
  </noscript>
</head>

<body itemscope itemtype="http://schema.org/WebPage" class="use-motion">
  <div class="headband"></div>

  <main class="main">
    <div class="column">
      <header class="header" itemscope itemtype="http://schema.org/WPHeader"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切换导航栏" role="button">
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <i class="logo-line"></i>
      <p class="site-title">diffany</p>
      <i class="logo-line"></i>
    </a>
      <img class="custom-logo-image" src="/uploads/custom-logo.png" alt="diffany">
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger" aria-label="搜索" role="button">
        <i class="fa fa-search fa-fw fa-lg"></i>
    </div>
  </div>
</div>



<nav class="site-nav">
  <ul class="main-menu menu"><li class="menu-item menu-item-home"><a href="/" rel="section"><i class="fa fa-home fa-fw"></i>首页</a></li><li class="menu-item menu-item-about"><a href="/about/" rel="section"><i class="fa fa-user fa-fw"></i>关于</a></li><li class="menu-item menu-item-tags"><a href="/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>标签</a></li><li class="menu-item menu-item-categories"><a href="/categories/" rel="section"><i class="fa fa-th fa-fw"></i>分类</a></li><li class="menu-item menu-item-archives"><a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>归档</a></li><li class="menu-item menu-item-友情链接"><a href="/friend/" rel="section"><i class="fa fa-sitemap fa-fw"></i>友情链接</a></li>
      <li class="menu-item menu-item-search">
        <a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i>搜索
        </a>
      </li>
  </ul>
</nav>



  <div class="search-pop-overlay">
    <div class="popup search-popup"><div class="search-header">
  <span class="search-icon">
    <i class="fa fa-search"></i>
  </span>
  <div class="search-input-container">
    <input autocomplete="off" autocapitalize="off" maxlength="80"
           placeholder="搜索..." spellcheck="false"
           type="search" class="search-input">
  </div>
  <span class="popup-btn-close" role="button">
    <i class="fa fa-times-circle"></i>
  </span>
</div>
<div class="search-result-container no-result">
  <div class="search-result-icon">
    <i class="fa fa-spinner fa-pulse fa-5x"></i>
  </div>
</div>

    </div>
  </div>

</header>
        
  
  <aside class="sidebar">

    <div class="sidebar-inner sidebar-nav-active sidebar-toc-active">
      <ul class="sidebar-nav">
        <li class="sidebar-nav-toc">
          文章目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ul>

      <div class="sidebar-panel-container">
        <!--noindex-->
        <div class="post-toc-wrap sidebar-panel">
            <div class="post-toc animated"><ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link"><span class="nav-number">1.</span> <span class="nav-text">2023kalmarctf</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#crypto"><span class="nav-number">1.1.</span> <span class="nav-text">crypto</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#BabyOneTimePad"><span class="nav-number">1.1.1.</span> <span class="nav-text">BabyOneTimePad</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#EasyOneTimePad"><span class="nav-number">1.1.2.</span> <span class="nav-text">EasyOneTimePad</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#misc"><span class="nav-number">1.2.</span> <span class="nav-text">misc</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#kalmarunionen-fun"><span class="nav-number">1.2.1.</span> <span class="nav-text">kalmarunionen-fun</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#forensic"><span class="nav-number">1.3.</span> <span class="nav-text">forensic</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#lleHSyniT"><span class="nav-number">1.3.1.</span> <span class="nav-text">lleHSyniT!</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#cards"><span class="nav-number">1.3.2.</span> <span class="nav-text">cards</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#sewing-waste-and-agriculture-leftovers"><span class="nav-number">1.3.3.</span> <span class="nav-text">sewing-waste-and-agriculture-leftovers</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#web"><span class="nav-number">1.4.</span> <span class="nav-text">web</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#caddy"><span class="nav-number">1.4.1.</span> <span class="nav-text">caddy</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Invoiced"><span class="nav-number">1.4.2.</span> <span class="nav-text">Invoiced</span></a></li></ol></li></ol></li></ol></div>
        </div>
        <!--/noindex-->

        <div class="site-overview-wrap sidebar-panel">
          <div class="site-author animated" itemprop="author" itemscope itemtype="http://schema.org/Person">
  <p class="site-author-name" itemprop="name">diffany</p>
  <div class="site-description" itemprop="description">一个努力学习的菜鸟</div>
</div>
<div class="site-state-wrap animated">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
        <a href="/archives/">
          <span class="site-state-item-count">38</span>
          <span class="site-state-item-name">日志</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
          <a href="/categories/">
        <span class="site-state-item-count">9</span>
        <span class="site-state-item-name">分类</span></a>
      </div>
      <div class="site-state-item site-state-tags">
          <a href="/tags/">
        <span class="site-state-item-count">18</span>
        <span class="site-state-item-name">标签</span></a>
      </div>
  </nav>
</div>
  <div class="cc-license animated" itemprop="license">
    <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" class="cc-opacity" rel="noopener" target="_blank"><img src="https://unpkg.com/@creativecommons/vocabulary@2020.11.3/assets/license_badges/small/by_nc_sa.svg" alt="Creative Commons"></a>
  </div>

        </div>
      </div>
    </div>

    
        <div class="pjax">
        </div>
  </aside>


    </div>

    <div class="main-inner post posts-expand">


  


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://gudiffany.github.io/2023/03/06/13-29-58/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="diffany">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="diffany">
      <meta itemprop="description" content="一个努力学习的菜鸟">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="2023kalmarctf复现 | diffany">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          2023kalmarctf复现<a href="https://github.com/user-name/repo-name/tree/branch-name/subdirectory-name/_posts/2023kalmarctf%E5%A4%8D%E7%8E%B0.md" class="post-edit-link" title="编辑" rel="noopener" target="_blank"><i class="fa fa-pen-nib"></i></a>
        </h1>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2023-03-06 13:29:58" itemprop="dateCreated datePublished" datetime="2023-03-06T13:29:58+08:00">2023-03-06</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">更新于</span>
      <time title="修改时间：2023-03-13 20:18:01" itemprop="dateModified" datetime="2023-03-13T20:18:01+08:00">2023-03-13</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/2023wp/" itemprop="url" rel="index"><span itemprop="name">2023wp</span></a>
        </span>
    </span>

  
    <span id="/2023/03/06/13-29-58/" class="post-meta-item leancloud_visitors" data-flag-title="2023kalmarctf复现" title="阅读次数">
      <span class="post-meta-item-icon">
        <i class="far fa-eye"></i>
      </span>
      <span class="post-meta-item-text">阅读次数：</span>
      <span class="leancloud-visitors-count"></span>
    </span>
    <span class="post-meta-item" title="阅读次数" id="busuanzi_container_page_pv">
      <span class="post-meta-item-icon">
        <i class="far fa-eye"></i>
      </span>
      <span class="post-meta-item-text">阅读次数：</span>
      <span id="busuanzi_value_page_pv"></span>
    </span>
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
        <h1>2023kalmarctf</h1>
<span id="more"></span>
<h2 id="crypto">crypto</h2>
<h3 id="BabyOneTimePad">BabyOneTimePad</h3>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line">#!/usr/bin/env python3</span><br><span class="line"></span><br><span class="line">import os</span><br><span class="line"></span><br><span class="line">PASS_LENGTH_BYTES = 128</span><br><span class="line"></span><br><span class="line">def encrypt_otp(cleartext, key = os.urandom(PASS_LENGTH_BYTES)):</span><br><span class="line">    ciphertext = bytes([key[i % len(key)] ^ x for i,x in enumerate(cleartext.hex().encode())])</span><br><span class="line">    return ciphertext, key</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">if __name__ == &#x27;__main__&#x27;:</span><br><span class="line">    print(&#x27;According to Wikipedia:&#x27;)</span><br><span class="line">    print(&#x27;&quot;In cryptography, the one-time pad (OTP) is an encryption technique that cannot be cracked, but requires the use of a single-use pre-shared key that is not smaller than the message being sent.&quot;&#x27;)</span><br><span class="line">    print(&#x27;So have fun trying to figure out my password!&#x27;)</span><br><span class="line">    password = os.urandom(PASS_LENGTH_BYTES)</span><br><span class="line"></span><br><span class="line">    enc, _ = encrypt_otp(password)</span><br><span class="line">    print(f&#x27;Here is my password encrypted with a one-time pad: &#123;enc.hex()&#125;&#x27;)</span><br><span class="line">    print(&#x27;Actually, I will give you my password encrypted another time.&#x27;)</span><br><span class="line">    print(&#x27;This time you are allowed to permute the password first&#x27;)</span><br><span class="line">    permutation = input(&#x27;Permutation: &#x27;)</span><br><span class="line">    try:</span><br><span class="line">        permutation = [int(x) for x in permutation.strip().split(&#x27;,&#x27;)]</span><br><span class="line">        assert set(permutation) == set(range(PASS_LENGTH_BYTES))</span><br><span class="line">        enc, _ = encrypt_otp(bytes([password[permutation[i]] for i in range(PASS_LENGTH_BYTES)]))</span><br><span class="line">        print(f&#x27;Here is the permuted password encrypted with another one-time pad: &#123;enc.hex()&#125;&#x27;)</span><br><span class="line">    except:</span><br><span class="line">        print(&#x27;Something went wrong!&#x27;)</span><br><span class="line">        exit(1)</span><br><span class="line">    password_guess = input(&#x27;What is my password: &#x27;)</span><br><span class="line">    try:</span><br><span class="line">        password_guess = bytes.fromhex(password_guess)</span><br><span class="line">    except:</span><br><span class="line">        print(&#x27;Something went wrong!&#x27;)</span><br><span class="line">        exit(1)</span><br><span class="line">    if password_guess == password:</span><br><span class="line">        with open(&#x27;flag.txt&#x27;, &#x27;r&#x27;) as f:</span><br><span class="line">            flag = f.read()</span><br><span class="line">            print(f&#x27;The flag is &#123;flag&#125;&#x27;)</span><br><span class="line">    else:</span><br><span class="line">        print(&#x27;Nope.&#x27;)</span><br></pre></td></tr></table></figure>
<p>整个代码就是需要猜出password，第一次给出与key的异或结果，第二次我们可以控制password的置换位置结果，只要是permutation包含0-127的数字都存在就行，也就是说可以传入前面全部都是0，后面是1-127使得传入的password都是第一个字节，那么思路上面很简单。</p>
<p>那么只要恢复key和由key以及密文就可以解出明文</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">def encrypt_otp(cleartext, key = os.urandom(PASS_LENGTH_BYTES)):</span><br><span class="line">    ciphertext = bytes([key[i % len(key)] ^ x for i,x in enumerate(cleartext.hex().encode())])</span><br><span class="line">    return ciphertext, key</span><br></pre></td></tr></table></figure>
<p>这个函数就是加密函数</p>
<p>那么如果我们知道cleartext，那么就可以知道key，因为</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">encrypt_otp(t,c2)==key*2 # 其中t是password第一个字节*128，c2是第二次加密密文</span><br></pre></td></tr></table></figure>
<p>然后写出解密函数(假如知道key 的情况下面)</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">def decrypt_otp(ciphertext, key):</span><br><span class="line">    cleartext = bytes([key[i % len(key)] ^ x for i,x in enumerate(ciphertext)])</span><br><span class="line">    cleartext = bytes.fromhex(cleartext.decode())</span><br><span class="line">    return cleartext</span><br></pre></td></tr></table></figure>
<p>这时候我们只要通过爆破password的第一个字节，产生的key尝试去解出password就行了</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">c1=&#x27;35514e2c9d23bc0e0659b606173b5b4073985fa90e9aefe75b28fbaa0e8f7730ba242b9236b9fd58f65d4de7ce0c07befa8c14c8bd66035e1e26ddeb16ceae53741d18a15814e1b8cdc1fd4a932dd9ff792579a872864e98b56958a8f236a6f191e54d459a6430435cc11080fda483cb1ba5672ab5d6d96411b9c6c78d15988330011b7c9a29ba0b030eb151176a091579cf59aa5dccebe25a2caeab0f8e706cbf777e9737eda103a10c46e6990b5fbba88b15cae736570e1b7f8cbc47cbab05754d1ef70449b3b8c995fe1d932989ab7d7722a572861c9be2385efdf06df8aa99b71a17c833374f5ccf14d4a8f9869f43f53621e4d9d93246b09492df159fdb&#x27;</span><br><span class="line">c2=&#x27;35514f2c9e29ba0d0009e003106b5a4572985cfc5ecfb8e10b2af9af0889763bbd212ec033bdf709f10f4ce1cf5a54ebad8d1ecaed3404091974dae940ceac05724d48f40f43e4eac897fc4b992c88aa797229a370d61d9ce16d5cfef73daca192e51a12983467440ac51282fef2839c48a33021e4d3d86012bb95c0da409f8935514f2c9e29ba0d0009e003106b5a4572985cfc5ecfb8e10b2af9af0889763bbd212ec033bdf709f10f4ce1cf5a54ebad8d1ecaed3404091974dae940ceac05724d48f40f43e4eac897fc4b992c88aa797229a370d61d9ce16d5cfef73daca192e51a12983467440ac51282fef2839c48a33021e4d3d86012bb95c0da409f89&#x27;</span><br><span class="line">c1=bytes.fromhex(c1)</span><br><span class="line">c2=bytes.fromhex(c2)</span><br><span class="line">def encrypt_otp(cleartext, key):</span><br><span class="line">    ciphertext = bytes([key[i % len(key)] ^ x for i,x in enumerate(cleartext.hex().encode())])</span><br><span class="line">    return ciphertext</span><br><span class="line"></span><br><span class="line">def decrypt_otp(ciphertext, key):</span><br><span class="line">    cleartext = bytes([key[i % len(key)] ^ x for i,x in enumerate(ciphertext)])</span><br><span class="line">    cleartext = bytes.fromhex(cleartext.decode())</span><br><span class="line">    return cleartext.hex()</span><br><span class="line">key= b&#x27;\x07b&#125;\x1f\xac\x1a\x88&gt;2:\xd20&quot;Xhv@\xabn\xcfl\xfc\x8a\xd29\x19\xcb\x9c:\xbaD\x08\x8f\x12\x1c\xf3\x01\x8e\xc5:\xc3&lt;~\xd2\xfdif\xd8\x9f\xbe,\xf9\xdf\x076:+G\xe8\xdar\xfd\x9e6@~z\xc7=p\xd6\xd9\xfa\xa4\xcex\xab\x1f\xba\x99KA\x1b\x90B\xe5/\xaf\xd3^n\xcd\xc5\x0e\x9e\x92\xa0\xd6(!\xaa\x07Uw8\xf6 \xb1\xcc\xc1\xb1\xafz\x90\x02\x12\xd6\xe0\xeaS \x88\xa7\xf3\xe8s\xad\xba&#x27;</span><br><span class="line">ciphertext= b&#x27;5QO,\x9e)\xba\r\x00\t\xe0\x03\x10kZEr\x98\\\xfc^\xcf\xb8\xe1\x0b*\xf9\xaf\x08\x89v;\xbd!.\xc03\xbd\xf7\t\xf1\x0fL\xe1\xcfZT\xeb\xad\x8d\x1e\xca\xed4\x04\t\x19t\xda\xe9@\xce\xac\x05rMH\xf4\x0fC\xe4\xea\xc8\x97\xfcK\x99,\x88\xaayr)\xa3p\xd6\x1d\x9c\xe1m\\\xfe\xf7=\xac\xa1\x92\xe5\x1a\x12\x984gD\n\xc5\x12\x82\xfe\xf2\x83\x9cH\xa30!\xe4\xd3\xd8`\x12\xbb\x95\xc0\xda@\x9f\x895QO,\x9e)\xba\r\x00\t\xe0\x03\x10kZEr\x98\\\xfc^\xcf\xb8\xe1\x0b*\xf9\xaf\x08\x89v;\xbd!.\xc03\xbd\xf7\t\xf1\x0fL\xe1\xcfZT\xeb\xad\x8d\x1e\xca\xed4\x04\t\x19t\xda\xe9@\xce\xac\x05rMH\xf4\x0fC\xe4\xea\xc8\x97\xfcK\x99,\x88\xaayr)\xa3p\xd6\x1d\x9c\xe1m\\\xfe\xf7=\xac\xa1\x92\xe5\x1a\x12\x984gD\n\xc5\x12\x82\xfe\xf2\x83\x9cH\xa30!\xe4\xd3\xd8`\x12\xbb\x95\xc0\xda@\x9f\x89&#x27;</span><br><span class="line">Permutation: 0,.....0,1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16, 17, 18, 19, 20, 21, 22, 23, 24, 25, 26, 27, 28, 29, 30, 31, 32, 33, 34, 35, 36, 37, 38, 39, 40, 41, 42, 43, 44, 45, 46, 47, 48, 49, 50, 51, 52, 53, 54, 55, 56, 57, 58, 59, 60, 61, 62, 63, 64, 65, 66, 67, 68, 69, 70, 71, 72, 73, 74, 75, 76, 77, 78, 79, 80, 81, 82, 83, 84, 85, 86, 87, 88, 89, 90, 91, 92, 93, 94, 95, 96, 97, 98, 99, 100, 101, 102, 103, 104, 105, 106, 107, 108, 109, 110, 111, 112, 113, 114, 115, 116, 117, 118, 119, 120, 121, 122, 123, 124, 125, 126, 127</span><br><span class="line"># print(encrypt_otp(t,c2)==key*2)</span><br><span class="line">for i in range(256):</span><br><span class="line">    s=chr(i).encode()*128</span><br><span class="line">    key=encrypt_otp(s,c2)</span><br><span class="line">    try:</span><br><span class="line">        decrypt_otp(c1,key)</span><br><span class="line">        print(chr(i))</span><br><span class="line">        print(bytes.fromhex(decrypt_otp(c1,key)))</span><br><span class="line">    except:</span><br><span class="line">        continue</span><br><span class="line"></span><br><span class="line">password = b&#x27;\x233\x19@L\xd6\\63\x1f\xbf\xe5\xb1\x06E8Vzw\x8bZ5&gt;\xaf\xe2\x81\xba]ZQ\xd3\x0eL\xbf\xedz~2\x82\xcf-\xb8\x0c\xa7\xf7nx\x8c\x13\xed\x0c\xe4\xd7\x01\x1e-\xa5\xe8\xc67\x11\xa4\xefY|\xfcc%\x14\xcaR\xac\x9d~\x10\xa0\xc5\xe7TM\x0e\xbdl\xd9\xb0\x84\xdb\x9cu\x93\x81\xa4\x08\xdfVSS\xd0\x99\xea1\x0e\x862f\x95\x0c4\x1f\x00\\\xf8\x9a&amp;\xb4\xb8\xd9N\xd8p\x9eC):\xf8:\x7f*&#x27;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>那么就可以解出password了</p>
<p>注意：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">for i,x in enumerate(cleartext.hex().encode())</span><br></pre></td></tr></table></figure>
<p>会导致加密的长度发生变化</p>
<p>另外就是Permutation的零的个数问题，可能当时传少了，导致本地数据打通了，一打远程就炸。</p>
<p>还有就是如果利用pwntools打远程的话会导致try失效，所以本地跑脚本会让在解密出现不是utf-8编码的时候返回error，这样才能解密（大概是我的问题？？？）</p>
<h3 id="EasyOneTimePad">EasyOneTimePad</h3>
<p>在上一题的基础上，修复了非预期。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">assert len(permutation) == PASS_LENGTH_BYTES #确保长度</span><br><span class="line">key = os.urandom(PASS_LENGTH_BYTES) #保证两次使用了不一样的密钥</span><br></pre></td></tr></table></figure>
<p>那么，整个计算采用了两次密钥参与计算，计算上只是简单的异或，那么可以使用sage的多项式环解线性方程，或者使用z3约束求解（主要只是异或操作，容易求解）</p>
<p><a target="_blank" rel="noopener" href="https://blog.maple3142.net/2023/03/05/kalmarctf-2023-writeups/#babyonetimepad">KalmarCTF 2023 WriteUps | 廢文集中區 (maple3142.net)</a></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">def encrypt_otp_z3(pt_hex, key):</span><br><span class="line">    ciphertext = [key[i % len(key)] ^ x for i, x in enumerate(pt_hex)]</span><br><span class="line">    return ciphertext, key</span><br><span class="line"></span><br><span class="line">def solve(ct1, ct2):</span><br><span class="line">    sol = Solver()</span><br><span class="line">    pt_hex_sym = [BitVec(f&quot;pt_hex_&#123;i&#125;&quot;, 8) for i in range(PASS_LENGTH_BYTES * 2)]</span><br><span class="line">    for x in pt_hex_sym:</span><br><span class="line">        sol.add(Or([x == t for t in b&quot;0123456789abcdef&quot;]))</span><br><span class="line">    pt_sym = [(x, y) for x, y in zip(pt_hex_sym[::2], pt_hex_sym[1::2])]</span><br><span class="line">    pt2_sym = [pt_sym[perm[i]] for i in range(PASS_LENGTH_BYTES)]</span><br><span class="line">    pt2_hex_sym = sum([list(x) for x in pt2_sym], [])</span><br><span class="line">    key_sym = [BitVec(f&quot;key_&#123;i&#125;&quot;, 8) for i in range(PASS_LENGTH_BYTES)]</span><br><span class="line">    enc_sym, _ = encrypt_otp_z3(pt_hex_sym, key_sym)</span><br><span class="line">    for x, y in zip(ct1, enc_sym):</span><br><span class="line">        sol.add(x == y)</span><br><span class="line">    enc2_sym, _ = encrypt_otp_z3(pt2_hex_sym, key_sym)</span><br><span class="line">    for x, y in zip(ct2, enc2_sym):</span><br><span class="line">        sol.add(x == y)</span><br><span class="line">    assert sol.check() == sat</span><br><span class="line">    m = sol.model()</span><br><span class="line">    pt_hex = [m[x].as_long() for x in pt_hex_sym]</span><br><span class="line">    pwd = bytes.fromhex(&quot;&quot;.join([f&quot;&#123;x:02x&#125;&quot; for x in pt_hex])).decode()</span><br><span class="line">    return pwd</span><br></pre></td></tr></table></figure>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">pt_hex_sym = [BitVec(f&quot;pt_hex_&#123;i&#125;&quot;, 8) for i in range(PASS_LENGTH_BYTES * 2)]</span><br><span class="line">for x in pt_hex_sym:</span><br><span class="line">	sol.add(Or([x == t for t in b&quot;0123456789abcdef&quot;]))</span><br></pre></td></tr></table></figure>
<p>确保明文是16进制数</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">pt_sym = [(x, y) for x, y in zip(pt_hex_sym[::2], pt_hex_sym[1::2])] #合并形成两个16字节</span><br><span class="line">pt2_sym = [pt_sym[perm[i]] for i in range(PASS_LENGTH_BYTES)]  #第二次加密密文的置换</span><br><span class="line">pt2_hex_sym = sum([list(x) for x in pt2_sym], []) #将字节转化为列表，相当分离16进制的两位</span><br></pre></td></tr></table></figure>
<p>然后添加条件，加密和密文相同</p>
<p>解出结果</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">m[x].as_long()</span><br></pre></td></tr></table></figure>
<p>这个代码片段是在求解器的模型 <code>m</code> 中获取一个符号变量 <code>x</code> 的具体值。<code>m[x]</code> 表示 <code>x</code> 在模型中的值，它是一个 <code>BitVecRef</code> 对象，表示一个二进制位向量。而 <code>as_long()</code> 方法则将这个二进制位向量转换为对应的整数值。</p>
<p>然后转为16进制就行了</p>
<p>官方解法：<a target="_blank" rel="noopener" href="https://github.com/kalmarunionenctf/kalmarctf-2023/blob/main/crypto/EasyOneTimePad/solution/solve.py">kalmarctf-2023/solve.py at main · kalmarunionenctf/kalmarctf-2023 (github.com)</a></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">官方的思想是，利用阶为2的环解线性方程组</span><br><span class="line">但是一组密文没有办法解出，因为构成的矩阵不是满秩的</span><br><span class="line">利用置换构造，将矩阵填成满秩的，假设知道一个字节，解出全部的明文，并且确保在16进制内即可</span><br><span class="line">并且解法上使用16进制高位和低位分别爆破</span><br></pre></td></tr></table></figure>
<p>本地调试：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">remote = pwnlib.tubes.process.process(&#x27;./challenge.py&#x27;)</span><br></pre></td></tr></table></figure>
<h2 id="misc">misc</h2>
<h3 id="kalmarunionen-fun">kalmarunionen-fun</h3>
<p>题目给出了传感器的xyz轴的加速度。</p>
<p>这题属实是从来没有涉及过的</p>
<p>那么就简单跟着官方wp学习一下数据处理就好了。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line">import sys</span><br><span class="line"></span><br><span class="line">fname = sys.argv[1]</span><br><span class="line"></span><br><span class="line">prefix = &quot;&quot;</span><br><span class="line">if len(sys.argv)&gt;2:</span><br><span class="line">    prefix = sys.argv[2]</span><br><span class="line"></span><br><span class="line">f=open(fname)</span><br><span class="line">d=f.readlines()</span><br><span class="line">f.close()</span><br><span class="line"></span><br><span class="line">xarr = []</span><br><span class="line">yarr = []</span><br><span class="line">m = len(d)</span><br><span class="line">for line in d:</span><br><span class="line">    datatuple = eval(line)</span><br><span class="line">    xarr.append(datatuple[0])</span><br><span class="line">    yarr.append(datatuple[1])</span><br><span class="line"></span><br><span class="line">marr = [abs(x)+abs(y) for x,y in zip(xarr,yarr)]</span><br><span class="line">darr = [1 if x&gt;1.3 else 0 for x in marr]</span><br><span class="line">conseq0 = 0</span><br><span class="line">conseq1 = 0</span><br><span class="line">curlvl = 0</span><br><span class="line">signnum = 0</span><br><span class="line">lvlarr = []</span><br><span class="line">lastlvlchange = 0</span><br><span class="line"></span><br><span class="line">for i in range(len(darr)):</span><br><span class="line">    if darr[i]==0:</span><br><span class="line">        conseq0 += 1</span><br><span class="line">        conseq1 = 0</span><br><span class="line">    elif darr[i]==1:</span><br><span class="line">        conseq1 += 1</span><br><span class="line">        conseq0 = 0</span><br><span class="line">    if conseq0&gt;=4 and curlvl==1 and (i-lastlvlchange)&gt;23:</span><br><span class="line">        curlvl = 0</span><br><span class="line">        signnum += 1</span><br><span class="line">        print(&quot;Symbol &quot; + str(signnum) + &quot; length &quot; + str(i-lastlvlchange) + &quot; from &quot; + str(lastlvlchange) + &quot; to &quot; + str(i))</span><br><span class="line">        g=open(prefix + &quot;-&quot; + str(signnum) + &quot;.txt&quot;, &quot;w&quot;)</span><br><span class="line">        for x in zip(xarr[lastlvlchange:i], yarr[lastlvlchange:i]):</span><br><span class="line">            g.write(str(x) + &quot;\n&quot;)</span><br><span class="line">        g.close()</span><br><span class="line">        lastlvlchange = i</span><br><span class="line">    elif conseq1&gt;=4 and curlvl==0:</span><br><span class="line">        curlvl = 1</span><br><span class="line">        #signnum += 1</span><br><span class="line">    lvlarr.append(signnum)</span><br></pre></td></tr></table></figure>
<p>整个传感器的加速度由于现实上的测量无法做到平稳，需要一定的时间的数据才能认定该方向上的数据成立</p>
<p>将x,y的加速度提取出来。使用darr储存。跟踪conseq0和conseq1变量中零和一的连续运行长度。如果检测到至少4个时间步长的零运行，并且信号电平当前很高（curlvl=1），并且距离检测到最后一个符号已经有足够的时间（（i-lastlvlchange）&gt;23），脚本假定一个符号刚刚结束并开始一个新符号。它增加signnum变量以跟踪到目前为止检测到的符号数量，并打印出有关刚刚结束的符号的长度和时间的信息。它还将与该符号对应的加速度计数据写入一个新文件，该文件的名称基于命令行上提供的前缀。 如果检测到至少4个时间步长的运行，并且信号电平当前为低（curlvl=0），则脚本假定新符号刚刚开始并将curlvl设置为1。</p>
<p>之后的就是通过噪声定位物体<a target="_blank" rel="noopener" href="https://github.com/balzer82/Kalman/blob/master/Kalman-Filter-CA.ipynb">https://github.com/balzer82/Kalman/blob/master/Kalman-Filter-CA.ipynb</a></p>
<p>来生成过滤脚本，画出二维，记录最大的x和最小的x，如果之间的差距过大，记为0，否则记为1，然后转ascii即可</p>
<p>ps：前五个数据不要，本来手动跑的，预判第一个字符是k，但是复现出不来还怀疑是我的问题</p>
<p><img src="/img/image-20230312173012382.png" alt="WeirdTable" /></p>
<h2 id="forensic">forensic</h2>
<h3 id="lleHSyniT">lleHSyniT!</h3>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">strings proc.dmp  | grep -i kalmar</span><br><span class="line">password:kalmar&#123;My_F4v0r1t3_G4m3_1s_Cobalt_Strike:gL0b4l_0p3r4t0rs&#125;</span><br></pre></td></tr></table></figure>
<h3 id="cards">cards</h3>
<p>tcp 79流之后提取出字符</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">for i in &#123;79..157&#125;; do tshark -r cards.pcap -qz follow,tcp,raw,$i | awk &#x27;&#123;a[NR]=$0&#125;END&#123;gsub(/^[ \t]+|[ \t]+$/, &quot;&quot;, a[NR-1]); printf &quot;%s &quot;, a[NR-1]&#125;&#x27; &gt;&gt; output.txt;done</span><br></pre></td></tr></table></figure>
<p>解释：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">tshark -r cards.pcap -qz follow,tcp,raw,$i</span><br><span class="line">这个命令用于从PCAP文件中读取网络数据包并显示特定的TCP流的原始数据。</span><br><span class="line"></span><br><span class="line">其中，-r选项指定要读取的PCAP文件，-q选项指定使用“quiet”模式，即只输出所需的内容。</span><br><span class="line">-z选项指定要执行的协议分析器并指定相关选项，这里使用了follow,tcp,raw选项来表示要跟踪TCP流并输出其原始数据。</span><br><span class="line"></span><br><span class="line">$i表示要跟踪的TCP流的编号，利用bash循环得到79-157的tcp流</span><br><span class="line"></span><br><span class="line">具体来说，follow,tcp,raw选项将会对每个TCP流分别执行以下操作：</span><br><span class="line">以ASCII码形式显示TCP流的起始和结束时间，源地址和目的地址，以及TCP端口号。</span><br><span class="line">显示TCP流的原始数据（以十六进制和ASCII码形式显示）。</span><br><span class="line"></span><br><span class="line">如果只是需要原始数据，使用tshark -r cards.pcap -T fields -e data</span><br></pre></td></tr></table></figure>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">awk &#x27;&#123;a[NR]=$0&#125;END&#123;gsub(/^[ \t]+|[ \t]+$/, &quot;&quot;, a[NR-1]); printf &quot;%s &quot;, a[NR-1]&#125;&#x27;</span><br><span class="line">1. awk：启动 AWK 解释器。</span><br><span class="line">2. &#x27;&#123;&#125;&#x27;：包含 AWK 程序，其中单引号确保 shell 不解释程序。</span><br><span class="line">3. a[NR]=$0：创建一个名为 a 的数组，并将当前行的值（$0）分配给数组中具有当前行号（NR）的元素。这意味着输入的第一行将存储在 a[1] 中，第二行将存储在 a[2] 中，依此类推。</span><br><span class="line">4. END&#123;&#125;：表示在读取完所有输入行后执行的代码块。</span><br><span class="line">5. gsub(/^[ \t]+|[ \t]+$/, &quot;&quot;, a[NR-1])：使用 gsub() 函数从输入的倒数第二行（a[NR-1]）全局替换所有开头和结尾的空格字符为空字符串。正则表达式 /^[ \t]+|[ \t]+$/ 匹配字符串开头 (^) 或结尾 ($) 处的一个或多个空格或制表符 ([ \t]+)。gsub() 函数返回进行的替换次数，但此命令未使用此值。</span><br><span class="line">6. printf &quot;%s &quot;, a[NR-1]：使用 printf() 函数打印修改后的输入的倒数第二行（a[NR-1]），并附加一个空格字符 (&quot; &quot;)。%s 格式说明符指定要打印的字符串参数，这种情况下为修改后的倒数第二行。</span><br></pre></td></tr></table></figure>
<p>因此，这个 AWK 命令基本上逐行读取输入，将每行存储在一个数组中，从输入的倒数第二行中删除开头和结尾的空格字符，然后打印修改后的倒数第二行，并带有一个空格字符。</p>
<p>打乱的字符通过长度为135的ftp获得cwd目录顺序</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">tshark -r cards.pcap -Y &quot;frame.len == 135 and ftp.current-working-directory&quot; -T fields -e ftp.current-working-directory</span><br></pre></td></tr></table></figure>
<ol>
<li><code>tshark</code>：启动 tshark 工具。</li>
<li><code>-r cards.pcap</code>：指定要读取的 pcap 文件的路径和名称。</li>
<li><code>-Y &quot;frame.len == 135 and ftp.current-working-directory&quot;</code>：使用 Wireshark 显示过滤器语法来筛选符合条件的数据包。<code>frame.len == 135</code> 表示数据包长度为 135，这是某些 FTP 客户端发送 PWD 命令时的预期长度。<code>ftp.current-working-directory</code> 表示匹配包含 FTP 工作目录的数据包。</li>
<li><code>-T fields</code>：指定输出格式为字段形式。</li>
<li><code>-e ftp.current-working-directory</code>：指定要提取的字段，这里是 FTP 工作目录。</li>
</ol>
<p>写脚本重排就行了</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">m = &#x27;m_tfwr_flf_3eccaykdw_hhuhrld&#123;erae\n_onsuo&#125;04afr__ar_u1ut_ksffklas_hsce33f_e3p_hn&#x27;</span><br><span class="line"></span><br><span class="line">s = [345, 377, 378, 385, 387, 404, 368, 352, 354, 361, 383, 413, 355, 381, 397, 403, 369, 382, 400, 418, 386, 408, 388,</span><br><span class="line">     409, 358, 399, 412, 414, 348, 363, 347, 366, 405, 420, 364, 370, 416, 357, 359, 384, 419, 417, 380, 346, 353, 390,</span><br><span class="line">     392, 406, 343, 379, 396, 371, 362, 351, 393, 372, 373, 407, 411, 410, 342, 344, 398, 401, 356, 394, 349, 365, 391,</span><br><span class="line">     375, 395, 360, 402, 389, 374, 376, 415, 350, 367]</span><br><span class="line"></span><br><span class="line">cwd = [i - min(s) for i in s]</span><br><span class="line">print(cwd)</span><br><span class="line">for i in range(79):</span><br><span class="line">    j=cwd.index(i)</span><br><span class="line">    print(m[j],end=&#x27;&#x27;)</span><br></pre></td></tr></table></figure>
<h3 id="sewing-waste-and-agriculture-leftovers">sewing-waste-and-agriculture-leftovers</h3>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">tshark -2 -r swaal.pcap -R &quot;udp.port==9999&quot; -T fields -e data | tr -d &#x27;\n&#x27; | fold -w 120 | while read l; do echo &quot;$l&quot; | xxd -r -p | tr -d &#x27;\n&#x27;; echo; done &gt; raw_bytes.txt</span><br></pre></td></tr></table></figure>
<ol>
<li><code>-R &quot;udp.port==9999&quot;</code>：使用 Wireshark 显示过滤器语法来筛选符合条件的数据包。这里表示仅提取 UDP 端口为 9999 的数据包。</li>
<li><code>-T fields</code>：指定输出格式为字段形式。</li>
<li><code>-e data</code>：指定要提取的字段，这里是 UDP 数据包的数据字段。</li>
<li><code>tr -d '\n'</code>：使用 <code>tr</code> 命令删除输出中的所有换行符，以便将所有提取的数据合并到一行中。</li>
<li><code>fold -w 120</code>：使用 <code>fold</code> 命令将长行分成每行 120 个字符。这样做是为了在输出中使数据更易读。</li>
<li><code>while read l; do</code>：使用 <code>while</code> 循环读取每个行，并将其存储在变量 <code>l</code> 中。</li>
<li><code>echo &quot;$l&quot; | xxd -r -p</code>：使用 <code>xxd</code> 命令将十六进制字符串转换为原始字节。</li>
<li><code>tr -d '\n'</code>：使用 <code>tr</code> 命令删除输出中的所有换行符，以便将所有字节合并到一行中。</li>
<li><code>echo</code>：使用 <code>echo</code> 命令输出一个换行符，以便将每行输出到不同的行中。</li>
<li><code>done &gt; raw_bytes.txt</code>：将输出重定向到文件 <code>raw_bytes.txt</code> 中。</li>
</ol>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">for i in &#123;1..58&#125;; do cat raw_bytes.txt | cut -b &quot;$i&quot; | sort -u | tr -d &#x27;\n&#x27;; done; echo</span><br></pre></td></tr></table></figure>
<ol>
<li><code>cut -b &quot;$i&quot;</code>：使用 cut 命令提取一个字符串的第 i 个字节。</li>
<li><code>sort -u</code>：使用 sort 命令对提取的字节进行排序并去重。<code>-u</code> 选项告诉 sort 命令只输出不同的行。</li>
<li><code>tr -d '\n'</code>：使用 tr 命令删除输出中的所有换行符，以便将所有去重的字节合并到一行中。</li>
</ol>
<h2 id="web">web</h2>
<h3 id="caddy">caddy</h3>
<p>docker文件：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">version: &#x27;3.7&#x27;</span><br><span class="line"></span><br><span class="line">services:</span><br><span class="line">  caddy:</span><br><span class="line">    image: caddy:2.4.5-alpine</span><br><span class="line">    restart: unless-stopped</span><br><span class="line">    ports:</span><br><span class="line">      - &quot;80:80&quot;</span><br><span class="line">      - &quot;443:443&quot;</span><br><span class="line">    volumes:</span><br><span class="line">      - ./files/Caddyfile:/etc/caddy/Caddyfile:ro</span><br><span class="line">      - ./files:/srv</span><br><span class="line">      - caddy_data:/data</span><br><span class="line">      - caddy_config:/config</span><br><span class="line">    command: sh -c &quot;apk add --update openssl nss-tools &amp;&amp; rm -rf /var/cache/apk/ &amp;&amp; openssl req -x509 -batch -newkey rsa:2048 -nodes -keyout /etc/ssl/private/caddy.key -days 365 -out /etc/ssl/certs/caddy.pem -subj &#x27;/C=DK/O=Kalmarunionen/CN=*.caddy.chal-kalmarc.tf&#x27; &amp;&amp; mkdir -p backups/ &amp;&amp; cp -r *.caddy.chal-kalmarc.tf backups/ &amp;&amp; rm php.caddy.chal-kalmarc.tf/flag.txt &amp;&amp; sleep 1 &amp;&amp; caddy run&quot;</span><br><span class="line"></span><br><span class="line">volumes:</span><br><span class="line">  caddy_data:</span><br><span class="line">    external: true</span><br><span class="line">  caddy_config:</span><br></pre></td></tr></table></figure>
<p>其中将flag复制到backups，删除了flag.txt</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">command: 指定在启动容器时要运行的命令。它使用&quot;sh -c&quot;运行一系列命令。</span><br><span class="line">首先使用&quot;apk add&quot;命令安装一些必要的包，然后使用&quot;openssl req&quot;命令生成自签名证书，并将其复制到指定的位置。</span><br><span class="line">接着，它创建一个名为&quot;backups&quot;的目录，并将所有以&quot;.caddy.chal-kalmarc.tf&quot;结尾的文件夹复制到该目录中。</span><br><span class="line">然后，它从&quot;php.caddy.chal-kalmarc.tf&quot;目录中删除&quot;flag.txt&quot;文件，并在1秒后启动Caddy服务。</span><br></pre></td></tr></table></figure>
<p><a target="_blank" rel="noopener" href="http://php.caddy.chal-kalmarc.tf/flag.txt%E5%B7%B2%E7%BB%8F%E8%A2%AB%E5%88%A0%E9%99%A4%EF%BC%8C%E9%82%A3%E4%B9%88%E5%B0%B1%E6%98%AF%E8%A6%81%E8%AE%BF%E9%97%AE%E5%88%B0%E5%A4%87%E4%BB%BD%E6%96%87%E4%BB%B6/backups/..../flag.txt%EF%BC%8C">php.caddy.chal-kalmarc.tf/flag.txt已经被删除，那么就是要访问到备份文件/backups/..../flag.txt，</a></p>
<p>根据<a target="_blank" rel="noopener" href="https://github.com/caddyserver/caddy/pull/4407">https://github.com/caddyserver/caddy/pull/4407</a></p>
<p>也就是说存在可以访问/backups/…/flag.txt的方法，只需要抓包修改url访问//flag.txt和host为/backups/php.caddy.chal-kalmarc.tf即可</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">curl --path-as-is -k --resolve php.caddy.kalmarc.tf:443:172.18.0.1 http://php.caddy.kalmarc.tf//flag.txt -H &#x27;Host: backups/php.caddy.kalmarc.tf&#x27;</span><br></pre></td></tr></table></figure>
<h3 id="Invoiced">Invoiced</h3>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">用meta来重定向..... 学习了</span><br><span class="line"></span><br><span class="line">http-equiv：定义与 HTTP 头部一起使用的名称。如果网页从 Web 服务器传送，则该属性会被忽略。</span><br><span class="line">http-equiv 是 &lt;meta&gt; 标签中的一个可选属性，用于模拟 HTTP 头信息中的一些属性。当 http-equiv 属性被设置时，content 属性必须也被设置，以提供额外的信息。</span><br><span class="line">http-equiv 属性通常用于控制页面的缓存、重定向、字符集、XSS保护等行为。以下是一些常用的 http-equiv 属性：</span><br><span class="line">content-language：指定文档的语言，如 &lt;meta http-equiv=&quot;content-language&quot; content=&quot;zh-CN&quot;&gt; 表示页面使用简体中文语言。</span><br><span class="line">expires：指定网页的到期时间，如 &lt;meta http-equiv=&quot;expires&quot; content=&quot;Tue, 01 Jan 2030 00:00:00 GMT&quot;&gt; 表示网页的到期时间是 2030 年 1 月 1 日。</span><br><span class="line">refresh：指定网页的刷新时间和重定向地址，如 &lt;meta http-equiv=&quot;refresh&quot; content=&quot;5;URL=http://www.example.com/&quot;&gt; 表示网页将在 5 秒后自动刷新并重定向到 http://www.example.com/。</span><br><span class="line">content-type：指定网页的 MIME 类型和字符集，如 &lt;meta http-equiv=&quot;content-type&quot; content=&quot;text/html;charset=UTF-8&quot;&gt; 表示网页是 HTML 格式，并使用 UTF-8 字符集。</span><br><span class="line">X-UA-Compatible：指定浏览器的兼容模式，如 &lt;meta http-equiv=&quot;X-UA-Compatible&quot; content=&quot;IE=edge&quot;&gt; 表示强制使用最新的 IE 内核。</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">address=asd&amp;discount=FREEZTUFSSZ1412&amp;email=8870%40qq.com&amp;name=&lt;meta http-equiv=&quot;refresh&quot; content=&quot;0; url=http://127.0.0.1:5000/orders&quot;&gt;&amp;phone=1</span><br></pre></td></tr></table></figure>

    </div>

    
    
    

    <footer class="post-footer">
          

<div class="post-copyright">
<ul>
  <li class="post-copyright-author">
      <strong>本文作者： </strong>diffany
  </li>
  <li class="post-copyright-link">
      <strong>本文链接：</strong>
      <a href="https://gudiffany.github.io/2023/03/06/13-29-58/" title="2023kalmarctf复现">https://gudiffany.github.io/2023/03/06/13-29-58/</a>
  </li>
  <li class="post-copyright-license">
    <strong>版权声明： </strong>本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" rel="noopener" target="_blank"><i class="fab fa-fw fa-creative-commons"></i>BY-NC-SA</a> 许可协议。转载请注明出处！
  </li>
</ul>
</div>

          <div class="post-tags">
              <a href="/tags/2023ctf/" rel="tag"><i class="fa fa-tag"></i> 2023ctf</a>
          </div>

        

          <div class="post-nav">
            <div class="post-nav-item">
                <a href="/2023/03/03/19-14-44/" rel="prev" title="misc工具使用（图片篇）">
                  <i class="fa fa-chevron-left"></i> misc工具使用（图片篇）
                </a>
            </div>
            <div class="post-nav-item">
                <a href="/2023/03/09/11-43-09/" rel="next" title="rust_learn">
                  rust_learn <i class="fa fa-chevron-right"></i>
                </a>
            </div>
          </div>
    </footer>
  </article>
</div>






</div>
  </main>

  <footer class="footer">
    <div class="footer-inner">


<div class="copyright">
  &copy; 
  <span itemprop="copyrightYear">2023</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">diffany</span>
</div>
<div class="busuanzi-count">
    <span class="post-meta-item" id="busuanzi_container_site_uv">
      <span class="post-meta-item-icon">
        <i class="fa fa-user"></i>
      </span>
      <span class="site-uv" title="总访客量">
        <span id="busuanzi_value_site_uv"></span>
      </span>
    </span>
    <span class="post-meta-item" id="busuanzi_container_site_pv">
      <span class="post-meta-item-icon">
        <i class="fa fa-eye"></i>
      </span>
      <span class="site-pv" title="总访问量">
        <span id="busuanzi_value_site_pv"></span>
      </span>
    </span>
</div>
  <div class="powered-by">由 <a href="https://hexo.io/" rel="noopener" target="_blank">Hexo</a> & <a href="https://theme-next.js.org/" rel="noopener" target="_blank">NexT.Gemini</a> 强力驱动
  </div>

    </div>
  </footer>

  
  <div class="back-to-top" role="button" aria-label="返回顶部">
    <i class="fa fa-arrow-up fa-lg"></i>
    <span>0%</span>
  </div>

<noscript>
  <div class="noscript-warning">Theme NexT works best with JavaScript enabled</div>
</noscript>


  
  <script src="https://unpkg.com/animejs@3.2.1/lib/anime.min.js" integrity="sha256-XL2inqUJaslATFnHdJOi9GfQ60on8Wx1C2H8DYiN1xY=" crossorigin="anonymous"></script>
  <script src="https://unpkg.com/@next-theme/pjax@0.6.0/pjax.min.js" integrity="sha256-vxLn1tSKWD4dqbMRyv940UYw4sXgMtYcK6reefzZrao=" crossorigin="anonymous"></script>


  <script src="[object Object]"></script>
  <script src="/%5Bobject%20Object%5D"></script>
  <script src="/%5Bobject%20Object%5D"></script>


<script>
var options = {
  bottom: '64px', // default: '32px'
  right: 'unset', // default: '32px'
  left: '32px', // default: 'unset'
  time: '0.5s', // default: '0.3s'
  mixColor: '#fff', // default: '#fff'
  backgroundColor: '#fff',  // default: '#fff'
  buttonColorDark: '#100f2c',  // default: '#100f2c'
  buttonColorLight: '#fff', // default: '#fff'
  saveInCookies: true, // default: true,
  label: '🌓', // default: ''
  autoMatchOsTheme: true // default: true
}
const darkmode = new Darkmode(options);
darkmode.showWidget();
</script>
<script src="/js/comments.js"></script><script src="/js/utils.js"></script><script src="/js/motion.js"></script><script src="/js/next-boot.js"></script><script src="/js/pjax.js"></script>

  <script src="https://unpkg.com/hexo-generator-searchdb@1.4.1/dist/search.js" integrity="sha256-1kfA5uHPf65M5cphT2dvymhkuyHPQp5A53EGZOnOLmc=" crossorigin="anonymous"></script>
<script src="/js/third-party/search/local-search.js"></script>





  
  <script data-pjax async src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>


  <script class="next-config" data-name="leancloud_visitors" type="application/json">{"enable":true,"app_id":"ImshWy4c6kiRqFukNXuAeVYt-gzGzoHsz","app_key":"I15dpBmlxhPPxNgS0pn9Fer5","server_url":null,"security":false}</script>
  <script src="/js/third-party/statistics/lean-analytics.js"></script>


  

  <script class="next-config" data-name="enableMath" type="application/json">false</script><script class="next-config" data-name="mathjax" type="application/json">{"enable":true,"tags":"all","js":{"url":"https://unpkg.com/mathjax@3.2.2/es5/tex-mml-chtml.js","integrity":"sha256-MASABpB4tYktI2Oitl4t+78w/lyA+D7b/s9GEP0JOGI="}}</script>
<script src="/js/third-party/math/mathjax.js"></script>



</body>
</html>
